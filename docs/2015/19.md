---
day: 19
title: Day 19
main_img:
  name: "Moleculer retrosynthesis"
  link: /assets/images/retrosynthesis.png
tags: 
  - name: Regex
    link: /python/regex
  - name: Sets
    link: /python/sets
---

## Page Navigation

- [Problem Intro](#problem-intro)
- [Point class solution](#point-class-solution)
  - [Part 1](#part-1)
  - [Part 2](#part-2)
  - [Results](#results)
- [NumPy solution](#numpy-solution)
  - [Part 1](#part-1-1)
  - [Part 2](#part-2-1)
  - [Results](#results-1)
- [Results](#results)

## Problem Intro

We're told Rudolph needs medicine, and we're going to need to synthesize the medicine! 
We are able to construct molecules using _reindeer chemistry_. We're told reindeer chemistry works by starting with some input molecule and then doing a series of replacements, one per step, until we have the right target molecule.

We're given sample input that looks something like this:

```text
e => H
e => O
H => HO
H => OH
O => HH

HOHOHO
```

The last row is the the _medicine molecule_ and the other rows are the possible replacements. Note how some molecules can be replaced with more than one target molecule.

## Part 1

First, we need to calibrate the reindeer chemistry machine. 

**How many distinct molecules can be created after all the different ways you can do one replacement on the medicine molecule?**

I start by reading in the data and constructing a mapping dictionary from each source molecule to the target molecules, and for each target molecule to its source:

```python
def process_input(data: list) -> tuple[dict, dict, str]:
    subst_match = re.compile(r"^(\w+) => (\w+)")
    
    # each src group can make many target groups
    src_groups = defaultdict(list)

    # each target group can be made from only one src group
    target_groups = {}

    for line in data:
        if "=>" in line:
            group, target_group = subst_match.findall(line)[0]
            src_groups[group] += [target_group]
            target_groups[target_group] = group

    logger.debug("Src groups:\n%s", src_groups)
    logger.debug("Target groups:\n%s", target_groups)
    return src_groups, target_groups, data[-1]
```

I'm using [regex](/python/regex) to parse the input lines for each group (nothing new here), and then - for the source groups - I'm using a [defaultdict](/python/defaultdict).  This is useful, because I want the `dict` key to be the source molecule, and the `dict` value to be a `list` of target molecules.  But I don't want to have to create the `list` for the first target molecule.

With the sample input above, this gives the following output:

<img src="{{'/assets/images/reindeer-chem-groups-output.png' | relative_url }}" alt="Reindeer chemistry groups" width="520px" />

Now, to solve part 2, I create a function that performs all the possible subtitutions:

```python
def substitute_groups(groups: dict, molecule: str) -> list:
    new_molecules = []

    # go through all the groups we have substitutions for
    for group, targets in groups.items():
        # get all matching positions for this group
        group_matches = re.finditer(group, molecule)

        # move left to right, matching group one at a time
        for group_match in group_matches:
            start, end = group_match.span()
            prefix = molecule[:start]
            suffix = molecule[end:]

            # replace the current group occurrence with each target
            for target in targets:
                new_molecules.append(prefix + target + suffix)
    
    return new_molecules
```

## Part 2


## Results

```text
```

You can see that this solution runs considerably faster, is easier to read, and requires a lot less code.